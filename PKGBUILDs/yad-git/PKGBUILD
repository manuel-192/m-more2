#!/bin/bash

# Maintainer: manuel (see forum.endeavouros.com)
# Maintainer: Christian Hesse <mail@eworm.de>
# Contributor: Aaron Fischer <mail@aaron-fischer.net>
# Contributor: Steven Allen <steven@stebalien.com>
# Contributor: trile7 at gmail dot com
# Contributor: Ernia <monghitri@aruba.it>

# Yad with "some" fixes.

pkgname=yad-fixed
pkgver=7.3
pkgrel=1
pkgdesc='A fork of zenity - display graphical dialogs from shell scripts or command line'
url='https://github.com/v1cont/yad'
arch=('x86_64')
license=('GPL3')
depends=('gtk3' 'webkit2gtk' 'gtkspell3')
makedepends=('autoconf' 'automake' 'intltool')
source=( git+${url}.git )
sha256sums=( SKIP )
provides=(yad)
conflicts=(yad yad-git)

prepare() {
    local patch=(
        " if (options.data.width > 0) {\n"
        "   gtk_widget_set_size_request (vbox, options.data.width, options.data.height);\n"
        " } else {\n"
        "   gint mw, nw;\n"
        "   gtk_widget_get_preferred_width (vbox, &mw, &nw);\n"
        "   gtk_widget_set_size_request (vbox, nw, -1);\n"
        " }\n"
    )
    sed -i yad/src/main.c \
        -e "/ parse geometry or move window, if given. must be after showing widget /i \ ${patch[*]}"
}

build() {
  cd yad

  autoreconf -ivf
  intltoolize
  ./configure \
    --prefix=/usr \
    --enable-icon-browser \
    --enable-html \
    --enable-gio \
    --enable-spell \
    --enable-sourceview

  make
}

package() {
  cd yad

  make DESTDIR="${pkgdir}" install
}
